10 REM A VARAZSERDO TITKA - C64 BASIC V2.0
20 REM BY CHRIS GARRETT STYLE PLAN
30 POKE 53280,0:POKE 53281,0:POKE 646,1:PRINT CHR$(147)
40 DIM N$(21),D$(21),M%(21,4),I$(11),IL%(11)
50 FOR I=1 TO 20:READ N$(I),D$(I):FOR J=1 TO 4:READ M%(I,J):NEXT J:NEXT I
60 FOR I=1 TO 10:READ I$(I),IL%(I):NEXT I
70 L=1:LK=1:BD=0:CV=0:LP=0:SQ=0:BG=0:REM FLAGS: LOC,LOCK,BRIDGE,CAVE,LAMP,SQUIRREL,BADGER
80 S=54272:W=54296:POKE W,15:REM SID VOL
90 GOTO 100
100 REM MAIN LOOP
110 PRINT CHR$(147)
120 GOSUB 3000:REM DRAW GRAPHICS
130 PRINT CHR$(18);N$(L);CHR$(146)
140 PRINT D$(L)
150 PRINT:PRINT "LATHATO TARGYAK:"
160 C=0:FOR I=1 TO 10:IF IL%(I)=L THEN PRINT " - ";I$(I):C=C+1
170 NEXT I:IF C=0 THEN PRINT " - NINCS"
180 IF L=12 AND LP=0 THEN GOTO 800:REM DEATH IN DARK CAVE
190 PRINT:PRINT "MIT TESZEL? ";:INPUT C$
200 IF LEN(C$)<1 THEN 100
210 V$="":O$="":SP=0
220 FOR I=1 TO LEN(C$):IF MID$(C$,I,1)=" " THEN SP=I:I=LEN(C$)
230 NEXT I
240 IF SP=0 THEN V$=C$:GOTO 260
250 V$=LEFT$(C$,SP-1):O$=MID$(C$,SP+1)
260 REM PARSER
270 IF LEFT$(V$,1)="E" OR LEFT$(V$,1)="D" OR LEFT$(V$,1)="K" OR LEFT$(V$,2)="NY" THEN GOSUB 500:GOTO 100
280 IF LEFT$(V$,4)="MEGY" THEN GOSUB 550:GOTO 100
290 IF LEFT$(V$,3)="NEZ" THEN 100
300 IF LEFT$(V$,6)="LELTAR" THEN GOSUB 1500:GOTO 350
310 IF LEFT$(V$,3)="FOG" THEN GOSUB 1000:GOTO 100
320 IF LEFT$(V$,5)="LERAK" THEN GOSUB 1100:GOTO 100
330 IF LEFT$(V$,7)="HASZNAL" THEN GOSUB 1200:GOTO 100
340 IF LEFT$(V$,6)="BESZEL" THEN GOSUB 1300:GOTO 350
350 PRINT:PRINT "NYOMJ EGY GOMBOT...":GET K$:IF K$="" THEN 350
360 GOTO 100
500 REM DIRECTION PARSE SHORT
510 D$="":IF LEFT$(V$,1)="E" THEN D$="E"
520 IF LEFT$(V$,1)="D" THEN D$="D"
530 IF LEFT$(V$,1)="K" THEN D$="K"
540 IF LEFT$(V$,2)="NY" THEN D$="N"
545 GOTO 600
550 REM DIRECTION PARSE LONG
560 D$="":IF LEFT$(O$,1)="E" THEN D$="E"
570 IF LEFT$(O$,1)="D" THEN D$="D"
580 IF LEFT$(O$,1)="K" THEN D$="K"
590 IF LEFT$(O$,2)="NY" THEN D$="N"
600 REM MOVE LOGIC
610 NX=0
620 IF D$="E" THEN NX=M%(L,1)
630 IF D$="K" THEN NX=M%(L,2)
640 IF D$="D" THEN NX=M%(L,3)
650 IF D$="N" THEN NX=M%(L,4)
660 IF NX=0 THEN PRINT "ARRA NEM MEHETSZ!":GOSUB 4100:RETURN
670 REM OBSTACLES
680 IF L=5 AND NX=6 AND BD=0 THEN PRINT "A HID LE VAN SZAKADVA!":GOSUB 4100:RETURN
690 IF L=8 AND NX=9 AND LK=1 THEN PRINT "AZAJTO ZARVA VAN.":GOSUB 4100:RETURN
700 IF L=11 AND NX=12 AND CV=0 THEN PRINT "EGY BORZ ELALLJA AZ UTAT!":GOSUB 4100:RETURN
710 L=NX:GOSUB 4000:RETURN
800 REM DEATH
810 PRINT "KOROMSOTET VAN. EGY SZORNY ELKAPOTT!"
820 PRINT "VEGE A JATEKNAK."
830 END
900 REM WIN
910 PRINT "GRATULALOK! MEGTALALTAD A KRISTALYT"
920 PRINT "ES MEGMENEKULTEL A VARAZSERDOBOL!"
930 END
1000 REM FOG (TAKE)
1010 ID=0:FOR I=1 TO 10:IF LEFT$(O$,3)=LEFT$(I$(I),3) THEN ID=I
1020 NEXT I
1030 IF ID=0 THEN PRINT "MI?":RETURN
1040 IF IL%(ID)<>L THEN PRINT "NINCS ITT ILYEN.":RETURN
1050 IL%(ID)=0:PRINT "FELVETTED: ";I$(ID)
1060 IF ID=7 THEN GOSUB 4200:REM GOT CRYSTAL
1070 RETURN
1100 REM LERAK (DROP)
1110 ID=0:FOR I=1 TO 10:IF LEFT$(O$,3)=LEFT$(I$(I),3) THEN ID=I
1120 NEXT I
1130 IF ID=0 THEN PRINT "MI?":RETURN
1140 IF IL%(ID)<>0 THEN PRINT "NINCS NALAD.":RETURN
1150 IL%(ID)=L:PRINT "LERAKTAD: ";I$(ID)
1160 RETURN
1200 REM HASZNAL (USE)
1210 ID=0:FOR I=1 TO 10:IF LEFT$(O$,3)=LEFT$(I$(I),3) THEN ID=I
1220 NEXT I
1230 IF ID=0 THEN PRINT "MI?":RETURN
1240 IF IL%(ID)<>0 THEN PRINT "NINCS NALAD.":RETURN
1250 REM PUZZLES
1260 IF ID=3 AND L=5 THEN BD=1:IL%(ID)=99:PRINT "MEGJAVITOTTAD A HIDAT!":GOSUB 4200:RETURN
1270 IF ID=2 AND L=8 THEN LK=0:PRINT "KINYITOTTAD AZ AJTOT!":GOSUB 4200:RETURN
1280 IF ID=5 AND IL%(6)=0 THEN LP=1:IL%(ID)=99:PRINT "MEGGYUJTOTTAD A LAMPAST!":GOSUB 4200:RETURN
1290 IF ID=7 AND L=1 THEN GOTO 900
1300 REM BESZEL/GIVE LOGIC (SIMPLIFIED CONTEXT)
1310 IF L=7 AND SQ=0 THEN PRINT "A MOKUS EHESNEK TUNIK."
1320 IF L=11 AND BG=0 THEN PRINT "A BORZ MORGOSNEK TUNIK."
1330 REM CHECK GIVE COMMANDS VIA USE OR TALK
1340 IF LEFT$(O$,3)="MOG" AND IL%(1)=0 AND L=7 THEN SQ=1:IL%(1)=99:IL%(2)=0:PRINT "A MOKUS ADOTT EGY KULCSOT!":GOSUB 4200
1350 IF LEFT$(O$,3)="MEZ" AND IL%(4)=0 AND L=11 THEN CV=1:IL%(4)=99:BG=1:PRINT "A BORZ ELMENT.":GOSUB 4200
1360 RETURN
1500 REM LELTAR (INVENTORY)
1510 PRINT "NALAD LEVO DOLGOK:"
1520 C=0:FOR I=1 TO 10:IF IL%(I)=0 THEN PRINT I$(I):C=C+1
1530 NEXT I:IF C=0 THEN PRINT "SEMMI."
1540 RETURN
3000 REM GRAPHICS ROUTINES
3010 PRINT CHR$(19):REM HOME
3020 C=5:IF L>5 AND L<15 THEN C=2:REM RED FOR DANGER
3030 IF L=12 OR L=17 THEN C=11:REM GREY FOR CAVE
3040 POKE 646,C
3050 FOR Y=1 TO 8
3060 FOR X=1 TO 38
3070 R=INT(RND(1)*10)
3080 IF C=5 THEN CH=102:IF R>7 THEN CH=32:REM FOREST
3090 IF C=11 THEN CH=160:IF R>8 THEN CH=46:REM CAVE
3100 IF C=2 THEN CH=119:IF R>6 THEN CH=32:REM SCARY
3110 IF L=4 OR L=18 THEN CH=83:REM WATER
3120 PRINT CHR$(CH);
3130 NEXT X:PRINT:NEXT Y
3140 POKE 646,1:PRINT "----------------------------------------"
3150 RETURN
4000 REM SOUND MOVE
4010 POKE S+5,9:POKE S+6,0:POKE S+24,129:POKE S+1,25:POKE S+4,33
4020 FOR T=1 TO 100:NEXT:POKE S+4,32:RETURN
4100 REM SOUND BAD
4110 POKE S+5,0:POKE S+6,240:POKE S+24,129:POKE S+1,15:POKE S+4,33
4120 FOR T=1 TO 200:NEXT:POKE S+4,32:RETURN
4200 REM SOUND GOOD
4210 POKE S+5,9:POKE S+6,0:POKE S+24,129:POKE S+1,40:POKE S+4,17
4220 FOR T=1 TO 50:NEXT:POKE S+4,16:POKE S+1,50:POKE S+4,17
4230 FOR T=1 TO 50:NEXT:POKE S+4,16:RETURN
5000 REM DATA: NAME, DESC, N, E, S, W
5010 DATA "ERDOSZELE","VILAGOS TISZTAS AZ ERDO SZELE.",2,0,0,0
5020 DATA "OSVENY","EGY KESKENY OSVENY VEZET ESZAKRA.",6,3,1,0
5030 DATA "ELAGAZAS","AZ UT KETFELE AGIN.",0,4,0,2
5040 DATA "FOLYO PART","A VIZ GYORSAN FOLYIK.",0,5,0,3
5050 DATA "LESZAKADT HID","A HID HIANYOS. KELL EGY DESZKA.",6,0,0,4
5060 DATA "SOTET ERDO","A FAK FENYEGETOEN SUSOGNAK.",7,14,2,5
5070 DATA "OREG TOLGY","EGY MOKUS UL AZ AGON.",0,8,6,0
5080 DATA "ERDESZHAZ","EGY ROZOGA HAZIKO. AZ AJTO ZARVA.",0,9,0,7
5090 DATA "HAZ BELSEJE","POROS ES POKHALOS A SZOBA.",0,0,0,8
5100 DATA "VADVIRAGOS RET","ILLATOS RET.",11,0,0,14
5110 DATA "BARLANG BEJARAT","EGY NAGY BARLANG. BORZ ORZI.",12,0,10,0
5120 DATA "SOTET BARLANG","NYIRKOS ES SOTET.",0,13,11,0
5130 DATA "KRISTALY TEREM","RAGYOG A KRISTALY FENYE.",0,0,0,12
5140 DATA "SURU BOZOT","ALIG LATSZ VALAMIT.",0,10,15,6
5150 DATA "MOCSAR","BUDOS ES RAGACSOS.",14,16,0,0
5160 DATA "DOMBTETO","ELLATSZ MESSZIRE.",0,0,17,15
5170 DATA "ELHAGYOTT BANYA","REGI BANYAJARAT.",16,0,0,0
5180 DATA "VIZESES","A VIZ LEZUDUL A MELYBE.",0,0,19,0
5190 DATA "TITKOS LIGET","BEKES HELY.",18,0,0,20
5200 DATA "SZIKLASZIRT","VESZELYES MAGASSAG.",0,19,0,0
5210 REM ITEMS: NAME, LOCATION
5220 DATA "MOGYORO",2
5230 DATA "EZUST KULCS",99
5240 DATA "DESZKA",4
5250 DATA "MEZESKALACS",9
5260 DATA "GYUFA",1
5270 DATA "LAMPAS",9
5280 DATA "KRISTALY HARMATCSEPP",13
5290 DATA "KARD",17
5300 DATA "ALMA",10
5310 DATA "KO",15
