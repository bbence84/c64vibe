10 POKE 53280,6:POKE 53281,6:POKE 646,14:PRINT CHR$(147);
20 REM *** TAPSI KALANDJA - C64 ADVENTURE ***
30 REM *** VARIABLES ***
40 PL=1:OC=10:RC=20:NC=5
50 DIM R$(RC),RE$(RC),RT(RC),O$(OC),OL(OC),N$(NC),NL(NC),ND$(NC)
60 GOSUB 2000:REM LOAD DATA
70 GOSUB 3000:REM INTRO SCREEN
80 REM *** MAIN LOOP ***
90 PRINT CHR$(147);
100 GOSUB 1000:REM DRAW GRAPHICS
110 PRINT CHR$(19);:FOR I=1 TO 11:PRINT:NEXT:REM MOVE CURSOR DOWN
120 PRINT CHR$(18);"HELYSZIN: ";R$(PL);CHR$(146)
130 GOSUB 1200:REM PRINT EXITS
140 GOSUB 1300:REM PRINT OBJECTS/NPCS
150 PRINT:INPUT "MIT TEGYEK";C$:IF C$="" THEN 90
160 GOSUB 400:REM PARSER
170 IF V$="KILEP" THEN END
180 IF V$="NEZ" OR V$="L" THEN 90
190 IF V$="E" OR V$="ESZAK" THEN D=1:GOSUB 500:GOTO 90
200 IF V$="D" OR V$="DEL" THEN D=2:GOSUB 500:GOTO 90
210 IF V$="K" OR V$="KELET" THEN D=3:GOSUB 500:GOTO 90
220 IF V$="NY" OR V$="NYUGAT" THEN D=4:GOSUB 500:GOTO 90
230 IF V$="FOG" OR V$="FELVESZ" THEN GOSUB 600:GOTO 90
240 IF V$="LERAK" OR V$="DOB" THEN GOSUB 650:GOTO 90
250 IF V$="HASZNAL" OR V$="HASZ" THEN GOSUB 700:GOTO 90
260 IF V$="ZSEB" OR V$="CUCCOK" OR V$="I" THEN GOSUB 800:GOTO 90
270 IF V$="BESZEL" OR V$="MOND" THEN GOSUB 850:GOTO 90
280 IF V$="AD" THEN GOSUB 900:GOTO 90
290 PRINT "NEM ERTEM A PARANCSOT.":FOR T=1 TO 500:NEXT:GOTO 90
400 REM *** PARSER ***
410 SP=0:L=LEN(C$):V$="":OB$=""
420 FOR I=1 TO L:CH$=MID$(C$,I,1)
430 IF CH$=" " THEN SP=I:I=L
440 NEXT I
450 IF SP=0 THEN V$=C$:RETURN
460 V$=LEFT$(C$,SP-1):OB$=MID$(C$,SP+1,L-SP):RETURN
500 REM *** MOVE ***
510 E$=RE$(PL):NX=VAL(MID$(E$,(D-1)*2+1,2))
520 IF NX=0 THEN PRINT "ARRA NEM MEHETSZ!":GOSUB 1500:RETURN
530 IF NX=99 THEN PRINT "AZ AJTO ZARVA VAN!":GOSUB 1500:RETURN
540 IF NX=98 THEN PRINT "A MEDVE UTJA ALL!":GOSUB 1500:RETURN
550 IF PL=8 AND NX=16 AND LT=0 THEN PRINT "TUL SOTET VAN ODABENT!":GOSUB 1500:RETURN
560 PL=NX:GOSUB 1510:RETURN
600 REM *** GET ITEM ***
610 ID=-1:FOR I=1 TO OC:IF O$(I)=OB$ THEN ID=I
620 NEXT I
630 IF ID=-1 THEN PRINT "NINCS ILYEN TARG ITT.":GOSUB 1500:RETURN
640 IF OL(ID)<>PL THEN PRINT "EZ NINCS ITT.":GOSUB 1500:RETURN
650 OL(ID)=0:PRINT "FELVETTED: ";O$(ID):GOSUB 1510
660 IF ID=1 THEN LT=1:REM LANTERN LOGIC
670 IF ID=10 THEN GOSUB 4000:REM WIN GAME
680 RETURN
650 REM *** DROP ITEM ***
660 ID=-1:FOR I=1 TO OC:IF O$(I)=OB$ THEN ID=I
670 NEXT I
680 IF ID=-1 THEN PRINT "NINCS NALAD ILYEN.":GOSUB 1500:RETURN
690 IF OL(ID)<>0 THEN PRINT "EZ NINCS NALAD.":GOSUB 1500:RETURN
700 OL(ID)=PL:PRINT "LERAKTAD: ";O$(ID):GOSUB 1510
710 IF ID=1 THEN LT=0
720 RETURN
700 REM *** USE ITEM ***
710 IF OB$="KULCS" AND OL(4)=0 AND PL=17 THEN RE$(17)="00180000":PRINT "KINYITOTTAD AZ AJTOT!":GOSUB 1510:RETURN
720 IF OB$="KOTEL" AND OL(5)=0 AND PL=6 THEN PRINT "LEERESZKEDTEL A KOTELLEL...":GOSUB 1510:RETURN
730 PRINT "EZT ITT NEM TUDOD HASZNALNI.":GOSUB 1500:RETURN
800 REM *** INVENTORY ***
810 PRINT "NALAD LEVO TARGYAK:":CN=0
820 FOR I=1 TO OC:IF OL(I)=0 THEN PRINT "- ";O$(I):CN=CN+1
830 NEXT:IF CN=0 THEN PRINT "URESEK A ZSEBEID."
840 PRINT "NYOMJ EGY GOMBOT.":GET K$:IF K$="" THEN 840
850 RETURN
850 REM *** TALK NPC ***
860 ID=-1:FOR I=1 TO NC:IF NL(I)=PL THEN ID=I
870 NEXT:IF ID=-1 THEN PRINT "NINCS ITT SENKI.":GOSUB 1500:RETURN
880 PRINT N$(ID);": ";ND$(ID)
890 IF ID=4 THEN PRINT "HA TUZ VAGYOK, ELEK. HA VIZET ISZOM, MEGHALOK. MI VAGYOK?"
900 PRINT "NYOMJ EGY GOMBOT.":GET K$:IF K$="" THEN 900
910 RETURN
900 REM *** GIVE ITEM ***
910 ID=-1:FOR I=1 TO NC:IF NL(I)=PL THEN ID=I
920 NEXT:IF ID=-1 THEN PRINT "NINCS KINEK ADNI.":GOSUB 1500:RETURN
930 IF ID=2 AND OB$="MEZ" THEN RE$(9)="00100000":NL(2)=0:PRINT "A MEDVE MEGESZI A MEZET ES ELMEGY!":GOSUB 1510:RETURN
940 IF ID=3 AND OB$="MAKK" THEN OL(3)=-1:OL(5)=0:PRINT "A MOKUS ADOTT EGY KOTELET!":GOSUB 1510:RETURN
950 PRINT "NEM KELL NEKI.":GOSUB 1500:RETURN
1000 REM *** DRAW GRAPHICS ***
1010 T=RT(PL):C1=5:C2=13:REM GREEN/LGREEN
1020 IF T=2 THEN C1=11:C2=12:REM GREY
1030 IF T=3 THEN C1=14:C2=6:REM BLUE
1040 IF T=4 THEN C1=7:C2=1:REM YELLOW
1050 FOR Y=0 TO 9
1060 IF T=1 THEN A$=CHR$(166)+CHR$(166)+CHR$(32)+CHR$(166):B$=CHR$(32)+CHR$(166)+CHR$(166)+CHR$(32):GOTO 1100
1070 IF T=2 THEN A$=CHR$(161)+CHR$(162)+CHR$(32)+CHR$(161):B$=CHR$(162)+CHR$(161)+CHR$(161)+CHR$(32):GOTO 1100
1080 IF T=3 THEN A$=CHR$(119)+CHR$(113)+CHR$(113)+CHR$(119):B$=CHR$(32)+CHR$(113)+CHR$(119)+CHR$(32):GOTO 1100
1090 A$=CHR$(32)+CHR$(32)+CHR$(32)+CHR$(32):B$=A$
1100 FOR X=0 TO 9:PRINT CHR$(C1);A$;CHR$(C2);B$;:NEXT:PRINT
1110 NEXT Y
1120 PRINT CHR$(158);"{cm s*39}";
1130 RETURN
1200 REM *** SHOW EXITS ***
1210 E$=RE$(PL):IF MID$(E$,1,2)<>"00" THEN PRINT "ESZAK ";
1220 IF MID$(E$,3,2)<>"00" THEN PRINT "DEL ";
1230 IF MID$(E$,5,2)<>"00" THEN PRINT "KELET ";
1240 IF MID$(E$,7,2)<>"00" THEN PRINT "NYUGAT ";
1250 RETURN
1300 REM *** SHOW CONTENT ***
1310 PRINT:PRINT "LATHATO: ";:CN=0
1320 FOR I=1 TO OC:IF OL(I)=PL THEN PRINT O$(I);", ";:CN=CN+1
1330 NEXT
1340 FOR I=1 TO NC:IF NL(I)=PL THEN PRINT N$(I);"(NPC), ";:CN=CN+1
1350 NEXT
1360 IF CN=0 THEN PRINT "SEMMI ERDEKES."
1370 RETURN
1500 REM *** ERROR SOUND ***
1501 S=54272:POKE S+24,15:POKE S+4,17:POKE S+1,20:POKE S+4,16:RETURN
1510 REM *** SUCCESS SOUND ***
1511 S=54272:POKE S+24,15:POKE S+4,17:POKE S+1,40:POKE S+4,16:FOR W=1 TO 100:NEXT:POKE S+4,17:POKE S+1,50:POKE S+4,16:RETURN
2000 REM *** LOAD DATA ***
2010 FOR I=1 TO RC:READ R$(I),RE$(I),RT(I):NEXT
2020 FOR I=1 TO OC:READ O$(I),OL(I):NEXT
2030 FOR I=1 TO NC:READ N$(I),NL(I),ND$(I):NEXT
2040 RETURN
2100 REM *** ROOM DATA ***
2110 DATA "NYULUREG","02000000",2
2120 DATA "NAPOS TISZTAS","05010304",1
2130 DATA "OREG TOLGY","00000002",1
2140 DATA "VIRAGOS RET","00000200",4
2150 DATA "SURU BOZOT","00020000",1
2160 DATA "PATAKPART","07000000",3
2170 DATA "VIZESES","00060000",3
2180 DATA "SOTET BARLANG","16000000",2
2190 DATA "MEDVE BARLANGJA","00009800",2
2200 DATA "FURESZ MALOM","00000009",4
2210 DATA "GOMBAKOR","00001200",1
2220 DATA "ELVARAZSOLT OSVENY","00000011",1
2230 DATA "BOLCS TEKNOS TOVA","00140000",3
2240 DATA "SIKLA","13000000",2
2250 DATA "ALOM VOLGY","17000000",4
2260 DATA "KRISTALY BARLANG","00080000",2
2270 DATA "ROMOS TORONY","00159900",4
2280 DATA "TORONY SZOBA","00000000",4
2290 DATA "ARNYEK ERDO","00000000",1
2300 DATA "ARANY KERT","00000000",4
2310 REM *** OBJ DATA ***
2320 DATA "LAMPAS",4,"MEZ",220,"MAKK",2,"KULCS",7,"KOTEL",-1
2330 DATA "HALO",10,"PIROS KRISTALY",16,"KEK KRISTALY",12,"ZOLD KRISTALY",14,"ARANY REPA",18
2340 REM *** NPC DATA ***
2350 DATA "BAGOLY BATYO",2,"HU-HU! KERESD A KULCSOT A VIZBEN!"
2360 DATA "MORGO MEDVE",9,"GRRR! EHES VAGYOK!"
2370 DATA "FURGE MOKUS",3,"MAKKOT KERESEK!"
2380 DATA "BOLCS TEKNOS",13,"A TORONY AJTAJA ZARVA VAN."
2390 DATA "ARNYROKA",19,"CSILLOG A KRISTALY A SOTETBEN."
3000 REM *** INTRO ***
3010 PRINT CHR$(147)
3020 PRINT "{down}{down}{down}"
3030 PRINT TAB(12);"{reverse on} TAPSI KALANDJA {reverse off}"
3040 PRINT "{down}"
3050 PRINT "EGY NYUL VAGY A VARAZSERDOBEN."
3060 PRINT "CELOD MEGTALALNI AZ ARANY REPAT."
3070 PRINT "PARANCSOK: ESZAK, DEL, KELET, NYUGAT"
3080 PRINT "           NEZ, FOG, LERAK, HASZNAL"
3090 PRINT "           BESZEL, AD, ZSEB"
3100 PRINT "{down}NYOMJ EGY GOMBOT..."
3110 GET K$:IF K$="" THEN 3110
3120 GOSUB 1510
3130 RETURN
4000 REM *** WIN ***
4010 PRINT CHR$(147);
4020 FOR I=1 TO 20:PRINT "* GRATULALOK TAPSI! *";:NEXT
4030 PRINT:PRINT "MEGTALALTAD AZ ARANY REPAT!"
4040 PRINT "ITT A VEGE, FUSS EL VELE."
4050 GOSUB 1510:GOSUB 1510
4060 END
